---
layout: post
title: 'Tester les log : espionner log4j'
tags:
- java
status: draft
type: post
published: false
meta:
  _edit_last: '4'
---
Pour capturer les logs, nous utilisons l'approche de plus en plus répandue de l'espionnage. Log4j permet d'ajouter un appender au rootLogger. On va donc créer le notre en implementant l'interface Appender :

<pre lang="java">public static class AppenderEspion implements Appender {
  List logs = Collections.synchronizedList(new ArrayList());

  public void doAppend(LoggingEvent event) {
    logs.add(event);
  }
  ...
}</pre>
Chaque message de log est ajouté à une liste (synchronisée pour la concurrence d'accès).
Les assertions recherchent les log dans cette liste.

Ensuite, on ajoute cet appender au <code>rootLogger</code> en passant par un test_logger :
<pre lang="java">proprietes.setProperty("log4j.rootLogger", "TRACE, test_logger");
proprietes.setProperty("log4j.appender.test_logger", AppenderEspion.class.getName());
PropertyConfigurator.configure(proprietes);</pre>
Pour les assertions, la précision du feedback est fondamentale. Ce sera l'objet d'un prochain billet.
