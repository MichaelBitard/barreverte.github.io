---
layout: post
title: 'Créer un chroot (part. 1) : un linux de base'
tags:
- philippe
- chroot
- linux
status: draft
type: post
published: false
meta:
  _edit_last: '4'
---
Pour initier un chroot, utilisons le package debootstrap :
<pre lang="bash">sudo apt-get install debootstrap</pre>
Il crée des arborescences Debian ou Ubuntu. Pour voir quelles versions sont disponibles :
<pre lang="bash">dpkg -L debootstrap | grep scripts/ | awk -F / '{print $NF}'</pre>
<ul>
	<li><code lang="bash">dpkg -L</code> liste tous les fichiers du package</li>
	<li><code lang="bash">grep scripts/</code> sélectionne les scripts</li>
	<li><code lang="bash">awk -F / '{print $NF}'</code> sélectionne leur nom</li>
</ul>
J'obtiens les versions disponibles à la fois pour debian (potato, sarge...) et pour ubuntu (lucid, maverick...) :
<pre>potato
sarge
...
lucid
maverick</pre>
Ensuite, on exécute la commande en tant que root, par exemple pour créer l'arborescence d'une lucid :
<pre lang="bash">sudo debootstrap lucid root_dir</pre>
root_dir représente la racine du chroot. En quelques minutes, une arborescence de 260 Mo a été crée. Un ls dans root_dir/ nous le confirme :
<pre lang="bash">root_dir$ ls
 bin  boot  dev  etc  home  lib  media  mnt  opt  proc  root  sbin  selinux  srv  sys  tmp  usr  var</pre>
On peut dès maintenant se connecter par
<pre lang="bash">sudo chroot root_dir/</pre>
et réussir à contacter barreverte.fr (ping barreverte.fr)

Toujours connecté au chroot (matérialisé dans la suite par l'invite 'chroot'), on créé un user pour représenter le projet (disons barreverte) :
<pre lang="bash">'chroot'$ adduser barreverte</pre>
et on peut maintenant se connecter en tant que barreverte :
<pre lang="bash">'chroot'$ su barreverte</pre>
Mais cette arborescence a besoin d'être rattachée à la machine sur laquelle elle va s'exécuter, ce qui fera l'objet d'un prochain billet...
