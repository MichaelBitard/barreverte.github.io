---
layout: post
title: Charger les sources avec maven
tags:
- philippe
- buildr
- classpath
- eclipse
- fest-assert
- java
- maven
- mvn
status: publish
type: post
published: true
meta:
  _edit_last: '4'
  _wp_old_slug: ''
---
Quand j'ai besoin d'essayer une lib sans impacter du code existant, je crée rapidement un projet jetable avec mvn :

<code>mvn archetype:generate</code>

<!--more-->Le projet par défaut, quickstart, convient : j'appuie directement sur return. Quelques questions génèrent un pom.xml auquel j'ajoute la librairie à expérimenter (<a href="http://mvnrepository.com/">mvnrepository.com</a> fournit groupId et artifactId) :
<pre lang="xml">
<dependency>
    <groupId>org.easytesting</groupId>
    <artifactId>fest-assert</artifactId>
    <version>1.3</version>
</dependency></pre>
Puis je génère le .classpath d'eclipse avec

<code>mvn eclipse:eclipse</code>

Toutes les dépendances sont téléchargées au passage. C'est un cas où les dépendances transitives aident, alors que sur du code de production cette transitivité nous a causé des soucis. Il ne reste qu'à importer le projet dans eclipse (Alt-f i "Existing Projects into Workspace").

Quand j'ai envie de rentrer dans le code source des lib, je régénère le .classpath avec <code>-DdownloadSources=true</code> :

<code>mvn eclipse:clean eclipse:eclipse -DdownloadSources=true</code>

Les sources sont récupérées et le .classpath se voit enrichit du <code>sourcepath</code> de chaque dépendance :
<pre lang='xml'><classpathentry kind="var" path="M2_REPO/.../fest-util-1.1.4.jar"
 sourcepath="M2_REPO/.../fest-util-1.1.4-sources.jar" /></pre> 

Attention à ne pas oublier <code>eclipse:clean</code> sinon le .classpath n'est pas enrichit.
 
<strong>Et buildr ?</strong>
 
Buildr permet de réaliser une partie de ces opérations, moyennant la création d'une arborescence minimale à la norme maven :

<ol>
	<li><code>mkdir -p src/main/java src/test/java</code></li>
	<li>créer une première classe</li>
	<li><code>buildr</code> propose ensuite de générer un buildfile à partir de cette arborescence :
<pre>To use Buildr you need a buildfile. Do you want me to create one?:
1. From directory structure</pre>
Répondre <code>1</code> amène à :
<pre lang="ruby">define "creerRapidementUnProjet" do
  ...
  compile.with # Add classpath dependencies
  test.compile.with # Add classpath dependencies
  ...
end</pre>
Sur cette première partie, buildr est beaucoup plus rapide que maven, mais il faut ensuite ajouter les dépendances une par une. Même si mvnrepository.com donne le format buildr, la recherche de chaque dépendance est vite rédhibitoire.</li>
	<li>pour finir, <code>buildr eclipse</code> génère le .classpath</li>
</ol>
<em>Update: le titre renforce l'aspect sources suite au commentaire de Bruno (remplace Essayer une lib dans un projet jetable).</em>
